user www-data;

# You must set worker processes based on your CPU cores, nginx does not benefit from setting more than that/
worker_processes auto;

# Number of file descriptors used for nginx/
# The limit for the maximum FDs on the server is usually set by the OS.
# If you don't set FD's then OS settings will be used which is by default 2000
worker_rlimit_nofile 100000;

# PID of the worker process.
pid /run/nginx.pid;

events {
# Determines how much clients will be served per worker.
# Max clients = worker_connections * worker_processes.
# Max clients is also limited by the number of socket connections available on the system (~64k).
        worker_connections 1024;

# Accept as many connections as possible, may flood worker connections if set too low -- for testing environment.
        multi_accept on;
}

http {
        include /etc/nginx/blacklist;
        include /etc/nginx/cloudflare;

# Cache informations about FDs, frequently accessed files.
# Can boost performance, but you need to test those values.
        open_file_cache max=200000 inactive=20s;
        open_file_cache_valid 30s;
        open_file_cache_min_uses 2;
        open_file_cache_errors on;

# Copies data between one FD and other from within the kernel.
# Faster than read() + write().
        sendfile on;

# Send headers in one piece, it is better than sending them one by one.
        tcp_nopush on;

# Don't buffer data sent, good for small data bursts in real time.
        tcp_nodelay on;

# Sets the maximum size of the types hash tables.
        types_hash_max_size 2048;

# Enables or disables emitting nginx version on error pages and in the “Server” response header field.
        server_tokens off;

# Sets the bucket size for the server names hash tables. The default value depends on the size of the processor’s cache line.
        server_names_hash_bucket_size 512;

# Enables or disables the use of the primary server name, specified by the server_name directive, in absolute redirects issued by nginx.
# When the use of the primary server name is disabled, the name from the “Host” request header field is used. If this field is not present, the IP address of the server is used.
        server_name_in_redirect off;

# Defines a timeout for reading client request header.
# If a client does not transmit the entire header within this time, the request is terminated with the 408 (Request Time-out) error -- default 1m.
        client_max_body_size 30m;

#Allows accurate tuning of per-request memory allocations.
        reset_timedout_connection on;

# If the request body size is more than the buffer size, then the entire (or partial).
# Request body is written into a temporary file.
        client_body_buffer_size  128k;

# If the request body size is more than the buffer size, then the entire (or partial).
# Request body is written into a temporary file.
        client_header_buffer_size 3m;

# Maximum number and size of buffers for large headers to read from client request.
        large_client_header_buffers 4 256k;

# Read timeout for the request body from client -- for testing environment.
        client_body_timeout 3m;

# How long to wait for the client to send a request header -- for testing environment.
        client_header_timeout 3m;

# If client stop responding, free up memory -- default 60.
        send_timeout 2;

# Server will close connection after this time -- default 75.
        keepalive_timeout 30;

# Number of requests client can make over keep-alive -- for testing environment.
        keepalive_requests 100000;

# Logging Settings.
        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

# Gzip Settings.
        gzip on;
        gzip_min_length 10240;
        gzip_comp_level 1;
        gzip_vary on;
        gzip_disable msie6;
        gzip_proxied expired no-cache no-store private auth;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

# Virtual Host Configs.
        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}